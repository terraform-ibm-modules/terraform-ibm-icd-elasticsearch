module "elasticsearch" {
  source                                               = "../fully-configurable"
  ibmcloud_api_key                                     = var.ibmcloud_api_key
  existing_resource_group_name                         = var.existing_resource_group_name
  prefix                                               = var.prefix
  name                                                 = var.name
  provider_visibility                                  = "private"
  region                                               = var.region
  existing_elasticsearch_instance_crn                  = var.existing_elasticsearch_instance_crn
  elasticsearch_version                                = var.elasticsearch_version
  plan                                                 = var.plan
  members                                              = var.members
  member_memory_mb                                     = var.member_memory_mb
  member_cpu_count                                     = var.member_cpu_count
  member_disk_mb                                       = var.member_disk_mb
  member_host_flavor                                   = var.member_host_flavor
  service_credential_names                             = var.service_credential_names
  admin_pass                                           = var.admin_pass
  users                                                = var.users
  resource_tags                                        = var.resource_tags
  access_tags                                          = var.access_tags
  kms_encryption_enabled                               = true
  existing_kms_instance_crn                            = var.existing_kms_instance_crn
  existing_kms_key_crn                                 = var.existing_kms_key_crn
  kms_endpoint_type                                    = "private"
  skip_elasticsearch_kms_auth_policy                   = var.skip_elasticsearch_kms_auth_policy
  ibmcloud_kms_api_key                                 = var.ibmcloud_kms_api_key
  key_ring_name                                        = var.key_ring_name
  key_name                                             = var.key_name
  existing_backup_kms_key_crn                          = var.existing_backup_kms_key_crn
  use_default_backup_encryption_key                    = false
  backup_crn                                           = var.backup_crn
  auto_scaling                                         = var.auto_scaling
  existing_secrets_manager_instance_crn                = var.existing_secrets_manager_instance_crn
  existing_secrets_manager_endpoint_type               = "private"
  service_credential_secrets                           = var.service_credential_secrets
  skip_elasticsearch_to_secrets_manager_auth_policy    = var.skip_elasticsearch_to_secrets_manager_auth_policy
  admin_pass_secrets_manager_secret_group              = var.admin_pass_secrets_manager_secret_group
  use_existing_admin_pass_secrets_manager_secret_group = var.use_existing_admin_pass_secrets_manager_secret_group
  admin_pass_secrets_manager_secret_name               = var.admin_pass_secrets_manager_secret_name
  service_endpoints                                    = "private"
  deletion_protection                                  = var.deletion_protection
  version_upgrade_skip_backup                          = false
  timeouts_update                                      = var.timeouts_update
  enable_elser_model                                   = var.enable_elser_model
  elser_model_type                                     = var.elser_model_type
  # Kibana Configuration
  kibana_code_engine_new_project_name = var.kibana_code_engine_new_project_name
  kibana_code_engine_new_app_name     = var.kibana_code_engine_new_app_name
  existing_code_engine_project_id     = var.existing_code_engine_project_id
  enable_kibana_dashboard             = var.enable_kibana_dashboard
  kibana_registry_namespace_image     = var.kibana_registry_namespace_image
  kibana_image_digest                 = var.kibana_image_digest
  kibana_image_port                   = var.kibana_image_port
  kibana_visibility                   = "local_private"
  kibana_system_secret_name           = var.kibana_system_secret_name
  kibana_app_secret_name              = var.kibana_app_secret_name
  cbr_rules                           = var.cbr_rules
}
